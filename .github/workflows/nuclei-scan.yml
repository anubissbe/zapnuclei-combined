name: Nuclei Security Scan

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

permissions:
  contents: read
  security-events: write

jobs:
  nuclei-scan:
    name: Nuclei Vulnerability Scan
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Nuclei Scan
        uses: projectdiscovery/nuclei-action@v2.0.1
        with:
          # Target URL to scan - replace with your application URL
          target: 'https://your-application-url.com'
          # Output formats
          sarif-export: 'nuclei-results.sarif'
          markdown-export: 'nuclei-report.md'
          # Template severity filters (optional - scan all by default)
          # severity: 'critical,high,medium'
          # Template types (optional)
          # templates: 'cves,vulnerabilities,exposed-panels,misconfigurations'
          # Rate limiting (requests per second)
          rate-limit: 150
          # GitHub token for downloading templates
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload Nuclei SARIF Report to GitHub Security
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: 'nuclei-results.sarif'
          category: 'nuclei-scan'
        if: always()

      - name: Upload Nuclei Report as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: nuclei-scan-report
          path: |
            nuclei-results.sarif
            nuclei-report.md
          retention-days: 30
        if: always()
